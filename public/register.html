<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro – HeyDoctor</title>

  <link rel="stylesheet" href="/src/style.css" />

  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
    }

    .register-container {
      max-width: 420px;
      margin: 60px auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .register-container img {
      width: 120px;
      display: block;
      margin: 0 auto 20px;
    }

    .register-container input {
      width: 100%;
      padding: 12px;
      margin-bottom: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 15px;
    }

    .btn-primary {
      width: 100%;
      padding: 14px;
      background: #07acb5;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }

    .btn-primary:hover {
      background: #068b91;
    }

    a {
      color: #07acb5;
      text-decoration: none;
    }
  </style>
</head>

<body>

  <div class="register-container">

    <img src="/public/heydoctor-logo.png" alt="HeyDoctor" />

    <h2 style="color:#078a92; text-align:center;">Crear cuenta</h2>

    <input id="reg-fullname" type="text" placeholder="Nombre completo" />
    <input id="reg-phone" type="text" placeholder="Teléfono" />
    <input id="reg-email" type="email" placeholder="Correo" />
    <input id="reg-password" type="password" placeholder="Contraseña" />

    <button class="btn-primary" onclick="handleRegister()">
      Crear cuenta
    </button>

    <p style="margin-top:20px; text-align:center;">
      ¿Ya tienes cuenta?
      <a href="/login.html">Inicia sesión</a>
    </p>
  </div>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    // Seguridad: variables de entorno desde Railway/Vite
    const supabase = createClient(
      import.meta.env.VITE_SUPABASE_URL,
      import.meta.env.VITE_SUPABASE_ANON_KEY
    );

    window.handleRegister = async () => {
      const fullName = document.getElementById("reg-fullname").value.trim();
      const phone = document.getElementById("reg-phone").value.trim();
      const email = document.getElementById("reg-email").value.trim();
      const password = document.getElementById("reg-password").value.trim();

      // Validación simple
      if (!fullName || !phone || !email || !password) {
        alert("Por favor completa todos los campos.");
        return;
      }

      // Registro Supabase
      const { data: userData, error: signUpError } = await supabase.auth.signUp({
        email,
        password
      });

      if (signUpError) {
        alert("Error al registrar: " + signUpError.message);
        return;
      }

      const userId = userData.user.id;

      // Guardar perfil
      const { error: profileError } = await supabase
        .from("profiles")
        .insert({
          id: userId,
          full_name: fullName,
          phone: phone
        });

      if (profileError) {
        alert("Error guardando perfil: " + profileError.message);
        return;
      }

      alert("Registro exitoso. Revisa tu correo.");
      window.location.href = "/login.html";
    };
  </script>

</body>
</html>
