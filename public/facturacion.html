<div style="padding: 30px;">

  <!-- TÃTULO -->
  <h1 style="
      font-family: Montserrat;
      color:#08b4bd;
      margin-bottom: 8px;
      text-shadow: 0 0 8px rgba(8,180,189,0.4);
    ">
    ðŸ’³ FacturaciÃ³n & Finanzas â€“ HeyDoctor
  </h1>

  <p style="color:#88a; margin-bottom: 30px;">
    GestiÃ³n de pagos, ingresos y facturas clÃ­nicas.
  </p>

  <!-- INDICADORES FINANCIEROS -->
  <div style="
    display:grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
  ">

    <!-- CARD 1 -->
    <div style="
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(8,180,189,0.4);
      backdrop-filter: blur(18px);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(8,180,189,0.25);
    ">
      <h3 style="color:#8ecfd0; margin:0 0 10px;">Ingresos del Mes</h3>
      <p id="ingresosMes" style="font-size:30px; color:white; margin:0;">$0</p>
    </div>

    <!-- CARD 2 -->
    <div style="
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(8,180,189,0.4);
      backdrop-filter: blur(18px);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(8,180,189,0.25);
    ">
      <h3 style="color:#8ecfd0; margin:0 0 10px;">Facturas emitidas</h3>
      <p id="facturasEmitidas" style="font-size:30px; color:white; margin:0;">0</p>
    </div>

    <!-- CARD 3 -->
    <div style="
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(8,180,189,0.4);
      backdrop-filter: blur(18px);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(8,180,189,0.25);
    ">
      <h3 style="color:#8ecfd0; margin:0 0 10px;">Pendientes de Pago</h3>
      <p id="pendientes" style="font-size:30px; color:white; margin:0;">0</p>
    </div>

    <!-- CARD 4 -->
    <div style="
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(8,180,189,0.4);
      backdrop-filter: blur(18px);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(8,180,189,0.25);
    ">
      <h3 style="color:#8ecfd0; margin:0 0 10px;">Promedio por Consulta</h3>
      <p id="promedioConsulta" style="font-size:30px; color:white; margin:0;">$0</p>
    </div>

  </div>

  <!-- BOTÃ“N NUEVA FACTURA -->
  <button onclick="openFactModal()" style="
      margin-top:30px;
      padding:16px;
      background:#08b4bd;
      color:white;
      border:none;
      border-radius:10px;
      font-size:16px;
      width:100%;
      box-shadow:0 0 12px rgba(8,180,189,0.4);
    ">
    + Emitir Nueva Factura
  </button>

  <!-- TABLA DE FACTURAS -->
  <h2 style="
      margin-top:40px;
      font-family:Montserrat;
      color:#08b4bd;
      text-shadow:0 0 6px rgba(8,180,189,0.4);
    ">
    ðŸ“‘ Historial de FacturaciÃ³n
  </h2>

  <table style="
      width: 100%;
      margin-top:15px;
      background:rgba(255,255,255,0.08);
      backdrop-filter:blur(14px);
      border-radius:12px;
      overflow:hidden;
      border:1px solid rgba(8,180,189,0.4);
    ">
    <thead style="background:rgba(8,180,189,0.2); color:white;">
      <tr>
        <th style="padding:12px; text-align:left;">Paciente</th>
        <th style="padding:12px; text-align:left;">Monto</th>
        <th style="padding:12px; text-align:left;">Fecha</th>
        <th style="padding:12px; text-align:left;">Estado</th>
      </tr>
    </thead>
    <tbody id="tablaFacturas" style="color:white;"></tbody>
  </table>

</div>

<!-- MODAL FACTURACIÃ“N -->
<div id="factModal" style="
    display:none;
    position:fixed; inset:0;
    background:rgba(0,0,0,0.5);
    justify-content:center;
    align-items:center;
  ">
  <div style="
      background:white;
      padding:25px;
      width:350px;
      border-radius:12px;
    ">
    <h2 style="color:#078a92;">Nueva Factura</h2>

    <input id="f-paciente" type="text" placeholder="Paciente"
      style="width:100%; padding:10px; margin-bottom:10px; border-radius:8px; border:1px solid #ccc;">

    <input id="f-monto" type="number" placeholder="Monto"
      style="width:100%; padding:10px; margin-bottom:10px; border-radius:8px; border:1px solid #ccc;">

    <select id="f-estado" style="
        width:100%; padding:10px; border-radius:8px;
        border:1px solid #ccc; margin-bottom:20px;
      ">
      <option value="Pagado">Pagado</option>
      <option value="Pendiente">Pendiente</option>
    </select>

    <button onclick="saveFactura()" style="
        width:100%; padding:12px;
        background:#07acb5; color:white;
        border:none; border-radius:8px;
      ">
      Guardar
    </button>

    <button onclick="closeFactModal()" style="
        width:100%; margin-top:10px; padding:12px;
        background:#ccc; border:none; border-radius:8px;
      ">
      Cancelar
    </button>
  </div>
</div>

<!-- JS -->
<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabase = createClient(
  "https://ozxguifbufymprfzzvin.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im96eGd1aWZidWZ5bXByZnp6dmluIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzNDgwMjAsImV4cCI6MjA3ODkyNDAyMH0.AEiGtqpx33u-qrsgBiJ-EEa6IsDuOUAuhdUL6lme_M4"
);

// Abrir modal
window.openFactModal = () => {
  document.getElementById("factModal").style.display = "flex";
};

// Cerrar modal
window.closeFactModal = () => {
  document.getElementById("factModal").style.display = "none";
};

// Guardar factura
window.saveFactura = async () => {
  const paciente = document.getElementById("f-paciente").value;
  const monto = document.getElementById("f-monto").value;
  const estado = document.getElementById("f-estado").value;

  await supabase.from("facturas").insert({
    paciente, monto, estado, fecha: new Date().toISOString().split("T")[0]
  });

  closeFactModal();
  loadFacturas();
};

// Cargar facturas al inicio
async function loadFacturas() {
  const { data } = await supabase.from("facturas").select("*");

  const tbody = document.getElementById("tablaFacturas");
  tbody.innerHTML = "";

  data.forEach(f => {
    tbody.innerHTML += `
      <tr>
        <td style="padding:12px;">${f.paciente}</td>
        <td style="padding:12px;">$${f.monto}</td>
        <td style="padding:12px;">${f.fecha}</td>
        <td style="padding:12px;">${f.estado}</td>
      </tr>
    `;
  });

  // EstadÃ­sticas
  document.getElementById("facturasEmitidas").innerText = data.length;

  // Suma ingresos
  const pagadas = data.filter(f => f.estado === "Pagado");
  const totalMes = pagadas.reduce((t, f) => t + Number(f.monto), 0);
  document.getElementById("ingresosMes").innerText = "$" + totalMes;

  // Promedio por consulta
  document.getElementById("promedioConsulta").innerText =
    "$" + Math.round(totalMes / (pagadas.length || 1));

  // Pendientes
  document.getElementById("pendientes").innerText =
    data.filter(f => f.estado === "Pendiente").length;
}

window.onload = loadFacturas;
</script>
